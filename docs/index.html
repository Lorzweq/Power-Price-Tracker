<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1e293b" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Pörssisähkö">
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    #authToggle {
      display: inline-block;
      transition: transform 0.3s ease;
    }
    
    /* Modal Blur Overlay */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      backdrop-filter: blur(4px);
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal-content {
      background: white;
      border-radius: 1.5rem;
      padding: 1.5rem;
      max-width: 28rem;
      width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      animation: slideIn 0.25s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 640px) {
      .modal-content {
        padding: 1.25rem;
        width: 95vw;
        border-radius: 1rem;
      }
    }
  </style>

  <!-- SEO -->
  <title>Pörssisähkö-säästölaskuri</title>
  <meta name="description" content="Laske pörssisähkön säästö siirtämällä laitteiden käyttöä halvemmille tunneille. Valitse laitteet, vertaa tuntihintoja ja ehdota halvin aloitusaika.">
  <meta name="robots" content="index,follow">
  <link rel="canonical" href="https://lorzweq.github.io/Power-Price-Tracker/">

  <meta property="og:title" content="Pörssisähkö-säästölaskuri">
  <meta property="og:description" content="Vertaa tuntihintoja ja löydä halvin käyttöaika laitteille.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://lorzweq.github.io/Power-Price-Tracker/">
  <meta property="og:locale" content="fi_FI">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Pörssisähkö-säästölaskuri",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Web",
    "description": "Laske pörssisähkön säästö siirtämällä laitteiden käyttöä halvemmille tunneille."
  }
  </script>
</head>

<body class="bg-slate-50 text-slate-900">
  <main class="w-full mx-auto px-3 sm:px-4 md:px-6 py-4 sm:py-6 max-w-7xl">
    <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-center">Pörssisähkö - säästö laitteella ja kellonajalla</h1>
    <p class="mt-2 text-xs sm:text-sm text-slate-600 text-center max-w-2xl mx-auto">
      Laske, kuinka paljon voit säästää siirtämällä sähkölaitteiden käyttöä edullisempaan aikaan päivän aikana.
      Valitse laitteet, määritä päivät ja kellonajat ja paina "Laske säästö".
    </p>

    <!-- Authentication Section (Collapsible) -->
    <div class="mt-6 rounded-2xl bg-gradient-to-r from-slate-100 to-slate-50 border border-slate-200 p-3 sm:p-4">
      <div class="flex items-center justify-between cursor-pointer" id="authHeader">
        <div class="flex items-center gap-2">
          <span id="authToggle" class="text-slate-900 transition-transform">▼</span>
          <div class="text-sm font-semibold text-slate-900">👤 Kirjautuminen</div>
        </div>
        <span id="authStatusBadge" class="text-xs px-2 py-1 rounded-lg bg-slate-200 text-slate-700">Ei kirjautunut</span>
      </div>
      
      <div id="authContent" class="mt-3 hidden">
        <div id="loginForm" class="p-3 rounded-lg bg-white border border-slate-300">
          <p class="text-xs font-semibold text-slate-900 mb-2">Kirjaudu sisään</p>
          <div class="flex flex-col gap-2">
            <input
              id="authEmail"
              type="email"
              placeholder="Sähköposti"
              class="h-9 rounded-lg border border-slate-300 p-2 text-xs"
            />
            <input
              id="authPassword"
              type="password"
              placeholder="Salasana"
              class="h-9 rounded-lg border border-slate-300 p-2 text-xs"
            />
            <div class="flex gap-2">
              <button id="loginBtn" class="flex-1 rounded-lg bg-slate-600 text-white py-2 px-3 font-bold hover:bg-slate-500 text-xs">
                Kirjaudu
              </button>
              <button id="openSignupModal" class="flex-1 rounded-lg bg-slate-400 text-white py-2 px-3 font-medium hover:bg-slate-300 text-xs">
                Rekisteröidy
              </button>
            </div>
          </div>
        </div>
        
        <div id="userInfo" class="hidden p-3 rounded-lg bg-white border border-slate-300">
          <div class="flex items-center justify-between">
            <p class="text-xs font-semibold text-slate-900">👤 <span id="userEmail"></span></p>
            <button id="logoutBtn" class="rounded-lg bg-slate-400 text-white py-1 px-2 font-medium hover:bg-slate-300 text-xs">
              Kirjaudu ulos
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-6 grid gap-3 sm:gap-4 md:gap-4 lg:grid-cols-3 xl:grid-cols-4">
      <div class="bg-white rounded-2xl shadow p-3 sm:p-4 md:p-5 lg:col-span-2 xl:col-span-2">
        <div class="flex items-center justify-between">
          <label class="block text-xs sm:text-sm font-medium">Laitteet</label>
          <button id="closeAllCategories" class="text-xs px-2 py-1 rounded bg-slate-200 hover:bg-slate-300 text-slate-700" title="Sulje kaikki kategoriat">Sulje kaikki</button>
        </div>

        <div id="deviceList" class="mt-2 grid gap-2"></div>

        <p class="mt-2 text-xs text-slate-500">
          Valitse yksi tai useampi laite.
        </p>

        <div class="mt-4">
          <div class="flex items-center justify-between">
            <span class="text-xs sm:text-sm font-medium">Kulutus</span>
            <span id="unitBadge" class="text-xs bg-slate-100 px-2 py-1 rounded-full"></span>
          </div>
          <p class="mt-1 text-xs sm:text-sm text-slate-600" id="consumptionText"></p>

          <label class="block mt-3 text-xs sm:text-sm font-medium">Käytettävä arvo</label>
          <select id="pick" class="mt-2 w-full rounded-xl border p-2 text-xs sm:text-sm">
            <option value="min">Min</option>
            <option value="avg" selected>Keskiarvo</option>
            <option value="max">Max</option>
          </select>

          <p id="note" class="mt-3 text-xs sm:text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-xl p-3 hidden"></p>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow p-3 sm:p-4 md:p-5 lg:col-span-1 xl:col-span-2">
        <div class="grid gap-2 sm:gap-3">
          <div>
            <label class="block text-xs sm:text-sm font-medium">Aika 1 (päivä + tunti)</label>

            <div class="flex items-end gap-2 flex-wrap">
              <input
                id="date1"
                type="date"
                class="flex-1 min-w-[140px] rounded-xl border p-2 text-xs sm:text-sm"
              >

              <div class="flex flex-col">
                <label class="text-xs sm:text-sm text-slate-600 mb-1">Klo</label>
                <input
                  id="hour1"
                  type="number"
                  min="0"
                  max="23"
                  value="18"
                  class="w-16 sm:w-20 rounded-xl border p-2 text-center text-xs sm:text-sm"
                />
              </div>
            </div>
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium">Aika 2 (vertailu)</label>

            <div class="flex items-end gap-2 flex-wrap">
              <input
                id="date2"
                type="date"
                class="flex-1 min-w-[140px] rounded-xl border p-2 text-xs sm:text-sm"
              >

              <div class="flex flex-col">
                <label class="text-xs sm:text-sm text-slate-600 mb-1">Klo</label>
                <input
                  id="hour2"
                  type="number"
                  min="0"
                  max="23"
                  value="2"
                  class="w-16 sm:w-20 rounded-xl border p-2 text-center text-xs sm:text-sm"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="mt-4 rounded-2xl border bg-slate-50 p-3 sm:p-4">
          <div class="text-xs sm:text-sm font-medium">Ehdota halvin aika</div>

          <div class="mt-2 grid gap-2 sm:gap-3 grid-cols-2 sm:grid-cols-4 items-start auto-rows-max">
            <div>
              <label class="block text-xs sm:text-sm text-slate-600 mb-1 whitespace-nowrap overflow-hidden text-ellipsis">Aikaväli alkaa</label>
              <input
                id="winStart"
                type="number"
                min="0"
                max="23"
                value="0"
                class="w-full h-10 rounded-xl border p-2 text-center text-xs sm:text-sm"
              />
            </div>

            <div>
              <label class="block text-xs sm:text-sm text-slate-600 mb-1 whitespace-nowrap overflow-hidden text-ellipsis">Aikaväli päättyy</label>
              <input
                id="winEnd"
                type="number"
                min="0"
                max="23"
                value="23"
                class="w-full h-10 rounded-xl border p-2 text-center text-xs sm:text-sm"
              />
            </div>

            <div>
              <label class="block text-xs sm:text-sm text-slate-600 mb-1 whitespace-nowrap overflow-hidden text-ellipsis">Kesto (h)</label>
              <input
                id="durHours"
                type="number"
                min="1"
                max="24"
                value="1"
                class="w-full h-10 rounded-xl border p-2 text-center text-xs sm:text-sm"
              />
            </div>

            <div>
              <label class="block text-xs sm:text-sm text-slate-600 mb-1 whitespace-nowrap overflow-hidden text-ellipsis">Päivä</label>
              <input
                id="date3"
                type="date"
                class="w-full h-10 rounded-xl border p-2 text-center text-xs sm:text-sm"
              />
            </div>
          </div>

          <div class="my-4 grid grid-cols-2 gap-2">
            <button id="saveFavorites" class="rounded-xl bg-slate-700 text-white py-2 px-2 font-medium hover:bg-slate-600 text-xs sm:text-sm" title="Tallenna nykyiset valinnat suosikeiksi">
              Tallenna suosikit
            </button>
            <button id="loadFavorites" class="rounded-xl bg-slate-700 text-white py-2 px-2 font-medium hover:bg-slate-600 text-xs sm:text-sm" title="Lataa aiemmin tallennetut suosikit">
              Lataa suosikit
            </button>
          </div>

          <div class="mb-3">
            <label class="block text-xs sm:text-sm text-slate-600 mb-1">Esiasetukset</label>
            <div class="flex gap-2">
              <select id="presetSelect" class="flex-1 h-10 rounded-xl border p-2 text-xs sm:text-sm">
                <option value="">Valitse esiasetus…</option>
                <option value="basic">Peruskoti</option>
                <option value="laundry">Pyykkipäivä</option>
                <option value="kitchen">Keittiöilta</option>
                <option value="evening">Viihdeilta</option>
              </select>
              <button id="applyPreset" class="rounded-xl bg-slate-700 text-white py-2 px-3 font-medium hover:bg-slate-600 text-xs sm:text-sm" title="Aseta laitevalinnat esiasetuksen mukaan">
                Käytä
              </button>
            </div>
            <div class="mt-1 text-xs text-slate-500">
              Valitse esiasetus ja muokkaa laitteita tai määriä tarvittaessa.
            </div>
          </div>

          <button id="autoOptimize" class="mb-2 rounded-xl w-full bg-slate-700 text-white py-2 px-2 font-medium hover:bg-slate-600 text-xs sm:text-sm" title="Laskee halvimman aloitusajan valituille laitteille ja päivittää ajan automaattisesti">
            Optimoi automaattisesti
          </button>
          <div class="mb-3 text-xs text-slate-500">
            Laskee valituille laitteille halvimman aloitusajan ja asettaa sen automaattisesti.
          </div>

          <button id="suggest" class="mb-4 rounded-xl w-full bg-slate-600 text-white py-2 px-2 font-medium hover:bg-slate-500 text-xs sm:text-sm" title="Ehdottaa halvinta aloitusaikaa valinnoille">
            Ehdota halvin aloitusaika
          </button>

          <div id="suggestOut" class="mt-3 text-xs sm:text-sm text-slate-700"></div>

          <div class="mt-6 rounded-2xl bg-blue-50 border border-blue-200 p-3 sm:p-4">
            <div class="flex items-center justify-between cursor-pointer" id="priceWatchHeader">
              <div class="flex items-center gap-2">
                <span id="priceWatchToggle" class="text-blue-900 transition-transform">▼</span>
                <div class="text-sm font-semibold text-blue-900">Price Watch</div>
              </div>
              <span id="premiumBadge" class="hidden px-2 py-1 text-xs font-bold rounded-lg bg-gradient-to-r from-yellow-400 to-yellow-600 text-slate-900">⭐ PREMIUM</span>
            </div>
            
            <div id="priceWatchContent">
              <p class="mt-1 text-xs text-blue-800">
                Saa ilmoitus, kun sähköhinta laskee alle asetetun rajan.
              </p>
              
              <!-- Premium Key Input -->
              <div id="premiumKeySection" class="mt-3 p-3 rounded-lg bg-yellow-50 border border-yellow-300">
                <p class="text-xs font-semibold text-yellow-900 mb-2">🔑 Aktivoi Premium</p>
                <div class="flex gap-2">
                  <input
                    id="premiumKeyInput"
                    type="text"
                    placeholder="Syötä premium-avain"
                    class="flex-1 h-9 rounded-lg border border-yellow-300 p-2 text-xs"
                  />
                  <button id="activatePremium" class="rounded-lg bg-yellow-500 text-slate-900 py-2 px-3 font-bold hover:bg-yellow-400 text-xs">
                    Aktivoi
                  </button>
                </div>
                <p class="mt-2 text-xs text-yellow-800">Laite ID: <span id="deviceIdDisplay" class="font-mono"></span></p>
              </div>

              <!-- Price Watch Controls -->
              <div id="priceWatchControls">
                <div class="mt-3 flex gap-2">
                  <input
                    id="priceWatchThreshold"
                    type="number"
                    placeholder="Hinta snt/kWh"
                    class="flex-1 h-10 rounded-xl border p-2 text-xs sm:text-sm"
                    step="0.01"
                    min="0"
                  />
                  <button id="startPriceWatch" class="rounded-xl bg-slate-600 text-white py-2 px-3 font-medium hover:bg-slate-500 text-xs sm:text-sm" title="Käynnistä hinnan seuranta">
                    Käynnistä
                  </button>
                  <button id="stopPriceWatch" class="hidden rounded-xl bg-slate-400 text-white py-2 px-3 font-medium hover:bg-slate-500 text-xs sm:text-sm" title="Pysäytä hinnan seuranta">
                    Pysäytä
                  </button>
                </div>
                <div id="priceWatchStatus" class="mt-2 text-xs text-blue-700"></div>
                <button id="simulatePriceWatch" class="mt-2 w-full rounded-lg bg-blue-200 text-blue-900 py-2 px-3 font-medium hover:bg-blue-300 text-xs sm:text-sm" title="Demonstroi Price Watch toiminta">
                  Simuloi hälytystä
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="my-4 grid grid-cols-2 gap-2">
          <button id="calc" class="rounded-xl bg-slate-900 text-white py-2 px-2 font-medium hover:bg-slate-800 text-xs sm:text-sm" title="Laske säästö valituille laitteille">
            Laske säästö
          </button>
          <button id="resetBtn" class="rounded-xl bg-slate-200 text-slate-700 py-2 px-2 font-medium hover:bg-slate-300 text-xs sm:text-sm" title="Tyhjennä kaikki valinnat">
            Tyhjennä valinnat
          </button>
        </div>

        <div class="mt-2 rounded-2xl bg-slate-50 border p-3 sm:p-4">
          <div class="flex items-center justify-between">
            <div class="text-xs sm:text-sm text-slate-600">Tulos</div>
            <div class="flex gap-2">
              <button id="priceToggle" class="text-xs px-2 py-1 rounded bg-slate-200 hover:bg-slate-300 text-slate-700" title="Vaihda hintojen esitystapaa">€ / snt</button>
              <button id="copyResults" class="hidden text-xs px-2 py-1 rounded bg-slate-700 hover:bg-slate-600 text-white" title="Kopioi tulos leikepöydälle">Kopioi</button>
            </div>
          </div>
          <div id="out" class="mt-2 text-xs sm:text-sm">Valitse laite ja paina "Laske säästö".</div>
        </div>
      </div>
    </div>

    <div class="mt-4 sm:mt-6 bg-white rounded-2xl shadow p-3 sm:p-4 md:p-5">
      <div class="flex flex-wrap items-center justify-between gap-2">
        <div class="flex items-center gap-1 sm:gap-3">
          <button id="chartPrev" class="rounded-xl border px-2 py-1 sm:px-3 sm:py-2 text-xs sm:text-sm hover:bg-slate-100" title="Aiemmat hinnat">
            <span class="hidden sm:inline">← Aiemmin</span>
            <span class="sm:hidden">←</span>
          </button>
          <div class="min-w-0">
            <div class="text-xs sm:text-sm text-slate-600">Päivän pörssisähkö (snt/kWh)</div>
            <div id="chartTitle" class="text-xs sm:text-sm font-medium truncate"></div>
          </div>
          <button id="chartNext" class="rounded-xl border px-2 py-1 sm:px-3 sm:py-2 text-xs sm:text-sm hover:bg-slate-100" title="Tulevat hinnat">
            <span class="hidden sm:inline">Myöhemmin →</span>
            <span class="sm:hidden">→</span>
          </button>
        </div>
        <button id="loadDay" class="rounded-xl border px-2 py-1 sm:px-3 sm:py-2 text-xs sm:text-sm hover:bg-slate-50" title="Palaa nykyhetken hintoihin">
          <span class="hidden sm:inline">Nykyhetki</span>
          <span class="sm:hidden">Nyt</span>
        </button>
      </div>

      <div class="overflow-x-auto">
        <canvas id="dayChart" class="mt-3 sm:mt-4 w-full" height="220" style="display: block; max-width: 100%;"></canvas>
      </div>

      <button id="showTop3" class="mt-3 rounded-xl bg-slate-700 text-white py-2 px-3 font-medium hover:bg-slate-600 text-xs sm:text-sm" title="Näytä kolme halvinta tuntia tästä näkymästä">
        Näytä 3 halvinta tuntia
      </button>
      <div id="top3Out" class="mt-3 text-xs sm:text-sm text-slate-700 hidden"></div>
    </div>

    <section class="mt-6 bg-white rounded-2xl shadow p-4">
      <h2 class="text-lg font-semibold">Palaute</h2>
      <p class="text-sm text-slate-600">
        Lähetä palautetta sovelluksesta.
      </p>

      <div class="mt-4 grid gap-3 md:grid-cols-2">
        <div>
          <label class="block text-xs sm:text-sm font-medium">Nimi (valinnainen)</label>
          <input
            id="fbName"
            type="text"
            class="mt-1 w-full rounded-xl border p-2 text-xs sm:text-sm"
            placeholder="Maija Meikäläinen"
          />
        </div>

        <div>
          <label class="block text-xs sm:text-sm font-medium">Arvosana</label>
          <select
            id="fbRating"
            class="mt-1 w-full rounded-xl border p-2 text-xs sm:text-sm"
          >
            <option value="">Valitse</option>
            <option value="5">⭐⭐⭐⭐⭐ 5</option>
            <option value="4">⭐⭐⭐⭐ 4</option>
            <option value="3">⭐⭐⭐ 3</option>
            <option value="2">⭐⭐ 2</option>
            <option value="1">⭐ 1</option>
          </select>
        </div>
      </div>

      <div class="mt-3">
        <label class="block text-xs sm:text-sm font-medium">Palaute</label>
        <textarea
          id="fbMessage"
          rows="4"
          class="mt-1 w-full rounded-xl border p-2 text-xs sm:text-sm"
          placeholder="Mikä toimi hyvin? Mitä parantaisit?"
          required
        ></textarea>
      </div>

      <button
        id="sendFeedback"
        class="mt-3 sm:mt-4 rounded-xl bg-slate-600 text-white px-3 sm:px-4 py-2 font-medium hover:bg-slate-700 text-xs sm:text-sm"
      >
        Lähetä palaute
      </button>
    </section>

    <!-- Footer: evästeasetukset + policy linkit -->
    <footer class="mt-8 pb-10 text-xs sm:text-sm text-slate-500 flex flex-col gap-2 sm:gap-3 items-center">
      <button id="openConsent" class="rounded-xl border px-2 sm:px-3 py-1 sm:py-2 hover:bg-slate-50 text-xs sm:text-sm">
        Muuta evästeasetuksia
      </button>
      <div class="flex gap-3 text-xs sm:text-sm">
        <a class="underline hover:no-underline" href="./privacy.html">Tietosuoja</a>
        <a class="underline hover:no-underline" href="./cookies.html">Evästeet</a>
      </div>
    </footer>

    <!-- Toast / popup -->
    <div
      id="toast"
      class="fixed bottom-4 left-1/2 z-[60] hidden -translate-x-1/2 transform rounded-2xl bg-slate-900 px-4 py-3 text-sm text-white shadow-lg transition-all duration-300 opacity-0 translate-y-4"
    >
      <span id="toastText">Viesti</span>
    </div>

    <!-- Cookie consent -->
    <div id="consentBanner" class="fixed bottom-4 left-1/2 z-[50] hidden -translate-x-1/2 transform max-w-xl w-[92%] rounded-2xl bg-white border shadow p-4">
      <div class="text-sm font-semibold">Evästeet</div>
      <p class="mt-1 text-sm text-slate-600">
        Käytämme evästeitä/analytiikkaa ja (valinnaisesti) mainoksia käyttökokemuksen ja rahoituksen vuoksi.
        Voit hyväksyä tai hylätä ei-välttämättömät.
      </p>
      <div class="mt-3 flex gap-2 justify-end">
        <button id="consentReject" class="rounded-xl border px-3 py-2 text-sm hover:bg-slate-50">
          Hylkää
        </button>
        <button id="consentAccept" class="rounded-xl bg-slate-900 text-white px-3 py-2 text-sm hover:bg-slate-800">
          Hyväksy
        </button>
      </div>
    </div>

  </main>

  <!-- Module Scripts -->
  <script type="module" src="./main.js"></script>

</body>
</html>

